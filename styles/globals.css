@tailwind base;
@tailwind components;
@tailwind utilities;

html {
  scroll-behavior: smooth;
  scroll-padding-top: 8rem; /* Ensure scroll padding for anchor links */
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  overflow-x: hidden;
  width: 100%;
}

/* Ensure all elements with IDs have proper scroll margin */
[id] {
  scroll-margin-top: 8rem;
}

body {
  margin: 0;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  @apply bg-cheese-50 dark:bg-[#0c0a09] text-cheese-950 dark:text-stone-200;
  @apply transition-all duration-700 ease-theme-spring;
  @apply selection:bg-cheese-300 selection:text-cheese-900 dark:selection:bg-cheese-500/30 dark:selection:text-cheese-100;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  -webkit-tap-highlight-color: transparent;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  @apply bg-cheese-50 dark:bg-[#0c0a09];
}

::-webkit-scrollbar-thumb {
  @apply bg-cheese-500/50 dark:bg-stone-800;
  border-radius: 5px;
  border: 2px solid transparent;
  background-clip: content-box;
}

::-webkit-scrollbar-thumb:hover {
  @apply bg-cheese-600 dark:bg-stone-700;
}

@media (hover: hover) and (pointer: fine) {
  ::-webkit-scrollbar-thumb:hover {
    @apply bg-cheese-600 dark:bg-stone-700;
  }
}

/* Utility classes */
.glass-panel {
  @apply bg-white/70 dark:bg-stone-900/40;
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
  @apply border border-white/50 dark:border-stone-800/50;
  @apply transition-all duration-500 ease-in-out;
}

@supports not (backdrop-filter: blur(10px)) {
  .glass-panel {
    @apply bg-white/95 dark:bg-stone-900/95;
  }
}

/* Markdown Code Block Overrides - Handled by Component now */
.prose pre {
  @apply !bg-transparent !p-0 !m-0 !border-none !shadow-none;
}

.prose pre code {
  @apply !p-0 !m-0 !bg-transparent;
}

/* Custom Checkbox Styling */
.checkbox-custom {
  display: inline-block !important;
  -webkit-appearance: none !important;
  -moz-appearance: none !important;
  appearance: none !important;
  @apply relative w-5 h-5 rounded-md border-2 cursor-default transition-all duration-200 mr-2 mt-1 flex-shrink-0;
  border-color: #FFD54F !important; /* cheese-400 */
  background-color: #FFF8E1 !important; /* cheese-100 */
}

.dark .checkbox-custom {
  border-color: #4E342E !important; /* cheese-950 */
  background-color: #1c1917 !important; /* stone-900 */
}

.checkbox-custom:checked {
  background-color: #FFB300 !important; /* cheese-600 */
  border-color: #FFB300 !important;
}

.checkbox-custom:checked::after {
  content: '';
  @apply absolute left-[5px] top-[1px] w-[6px] h-[10px] border-r-2 border-b-2 border-white rotate-45;
}

/* Task list styling */
.task-list-item {
  @apply flex items-start list-none !ml-0 !pl-0 mb-2;
}

.task-list-item input[type="checkbox"]:not(.checkbox-custom) {
  display: none !important;
}

.task-list-item p {
  @apply m-0 leading-relaxed;
}

.text-gradient {
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(to right, #FF8F00, #FFCA28);
}

* {
  touch-action: manipulation;
  -webkit-user-drag: none;
}

/* Improve keyboard focus visibility for interactive elements */
:focus-visible {
  outline: 3px solid rgba(255, 193, 7, 0.9);
  outline-offset: 3px;
  border-radius: 0.5rem;
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

img, video, canvas {
  max-width: 100%;
  height: auto;
  -webkit-user-select: none;
  user-select: none;
}

button, a {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

/* Ensure interactive elements are large enough for touch on small devices */
@media (max-width: 640px) {
  button, a {
    min-width: 44px;
    min-height: 44px;
    padding: 0.375rem; /* keep visual compactness while improving hit area */
  }
}

input, textarea, select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  border-radius: 0;
}

.transform-gpu {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-perspective: 1000px;
  perspective: 1000px;
}

h1, h2, h3, h4, h5, h6 {
  text-wrap: balance;
}

p {
  text-wrap: pretty;
}

:lang(zh), :lang(ja) {
  text-align: justify;
  font-feature-settings: "palt";
}

:lang(zh) p, :lang(ja) p,
:lang(zh) li, :lang(ja) li {
  line-height: 1.9; /* Increased for better readability */
  letter-spacing: 0.05em;
  margin-bottom: 1.5em; /* Add space between paragraphs */
}

:lang(zh) h1, :lang(zh) h2, :lang(zh) h3, :lang(zh) h4, :lang(zh) h5, :lang(zh) h6,
:lang(ja) h1, :lang(ja) h2, :lang(ja) h3, :lang(ja) h4, :lang(ja) h5, :lang(ja) h6 {
  line-height: 1.4;
  letter-spacing: 0.03em;
  word-break: keep-all; 
  overflow-wrap: break-word;
  font-weight: 700;
  margin-top: 2em; /* Clear separation for new sections */
  margin-bottom: 1em;
  text-wrap: balance;
}

:lang(en) {
  line-height: 1.6;
}

:lang(en) p {
  hyphens: auto;
  -webkit-hyphens: auto;
}

/* ----------------------------- */
/* Footnotes styling + iOS emoji fix */
/* ----------------------------- */

/* 修复脚注样式 */
.prose .footnotes {
  @apply mt-12 pt-8 border-t border-cheese-200/60 dark:border-stone-800 text-sm;
}

.prose .footnotes ol {
  @apply list-decimal list-outside ml-6;
}

.prose .footnotes li {
  @apply pl-2 text-stone-600 dark:text-stone-400;
}

/* 【关键修复】针对 iOS 脚注返回链接的 Emoji 去除 */
.prose .footnotes a[data-footnote-backref],
.prose .footnotes a[href^="#fnref"] {
  @apply no-underline opacity-50 hover:opacity-100 transition-opacity ml-1 align-middle inline-block;
  /* 隐藏原始文本（保留可访问性），使用伪元素渲染单色箭头，避免 iOS 彩色 emoji */
  color: transparent;
  position: relative;
  padding-left: 0.25rem;
  text-decoration: none;
}

.prose .footnotes a[data-footnote-backref]::after,
.prose .footnotes a[href^="#fnref"]::after {
  content: '↩';
  color: var(--tw-prose-links);
  display: inline-block;
  font-family: "Segoe UI Symbol", "Apple Symbols", "Noto Sans Symbols", system-ui, -apple-system, sans-serif;
  font-weight: 600;
  font-size: 0.95em;
  line-height: 1;
}

.dark .prose .footnotes a[data-footnote-backref]::after,
.dark .prose .footnotes a[href^="#fnref"]::after {
  color: #FFD54F;
}
